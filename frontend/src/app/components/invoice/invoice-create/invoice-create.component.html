<div class="invoice-container">
  <h2>Create Invoice</h2>
  <form [formGroup]="invoiceForm" (ngSubmit)="onSubmit()">
    <!-- Invoice Details -->
    <div formGroupName="invoice" class="invoice-info">

      <div class="input-container">
        <label>Bill from</label>
        <select name="" id="dropdown" formControlName="bill_from_id">
          <option value="" disabled selected>Select bill from</option>
          <option *ngFor="let item of customerData" [ngValue]="item.customer_id">
            {{item.name}}
          </option>
        </select>
        <p class="error-msg" *ngIf="invoiceForm.get('invoice.bill_from_id')?.invalid && submited">This field is required
        </p>
      </div>

      <div class="input-container">
        <label>Bill to</label>
        <select name="" id="dropdown" formControlName="bill_to_id">
          <option value="" disabled selected>Select bill to</option>
          <option *ngFor="let item of customerData" [ngValue]="item.customer_id">
            {{item.name}}
          </option>
        </select>
        <p class="error-msg" *ngIf="invoiceForm.get('invoice.bill_to_id')?.invalid && submited">This field is required
        </p>
      </div>

      <div class="input-container">
        <label>Invoice date</label>
        <input type="date" formControlName="invoice_date" placeholder="Select invoice date" />
        <p class="error-msg" *ngIf="invoiceForm.get('invoice.invoice_date')?.invalid && submited">This field is required
        </p>
      </div>

      <div class="input-container">
        <label>Due date</label>
        <input type="date" formControlName="due_date" placeholder="Select due date" />
        <p class="error-msg" *ngIf="invoiceForm.get('invoice.due_date')?.invalid && submited">This field is required</p>
      </div>

      <div class="input-container">
        <label>Tax rate (%)</label>
        <input type="text" appDecimalOnly formControlName="tax_rate" placeholder="Enter tax rate"
          (input)="calculateTotals()" />
        <p class="error-msg" *ngIf="invoiceForm.get('invoice.tax_rate')?.invalid && submited">This field is required</p>
      </div>
    </div>

    <!-- Invoice Items -->
    <h3>Items</h3>
    <table class="invoice-table">
      <thead>
        <tr>
          <th>Description</th>
          <th>Price</th>
          <th>Quantity</th>
          <th>Total</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody formArrayName="items">
        <tr *ngFor="let item of getitemsForms().controls; let i = index" [formGroupName]="i">
          <td><input type="text" formControlName="description" placeholder="Item description" /></td>
          <td><input type="text" appOnlyNumbers formControlName="price" placeholder="Price"
              (input)="calculateTotals()" /></td>
          <td><input type="text" appOnlyNumbers formControlName="quantity" placeholder="Qty"
              (input)="calculateTotals()" /></td>
          <td>{{ item.get('total')?.value | currency }}</td>
          <td>
            <button type="button" [disabled]="getitemsForms().length == 1" (click)="removeItem(i)">Remove</button>
          </td>
        </tr>
      </tbody>
    </table>
    <button type="button" class="add-btn" (click)="addItem()">+ Add Item</button>

    <!-- Payment and Terms -->
    <div class="invoice-info" formGroupName="invoice" style="margin-top: 20px;">
      <div class="input-container">
        <label>Payment Method</label>
        <select formControlName="payment_id">
          <option value="" disabled selected>Select payment method</option>
          <option *ngFor="let method of paymentMethods" [value]="method.payment_id">
            {{ method.bank_name }} ({{ method.account_number }})
          </option>
        </select>
        <p class="error-msg" *ngIf="invoiceForm.get('invoice.payment_id')?.invalid && submited">
          This field is required
        </p>
      </div>

      <div class="input-container">
        <label>Terms & Conditions</label>
        <select formControlName="term_id">
          <option value="" disabled selected>Select terms</option>
          <option *ngFor="let term of termsOptions" [value]="term.term_id">
            {{ term.terms }}
          </option>
        </select>
        <p class="error-msg" *ngIf="invoiceForm.get('invoice.term_id')?.invalid && submited">
          This field is required
        </p>
      </div>
    </div>

    <!-- Totals -->
    <div class="totals">
      <p>Subtotal: {{ invoiceForm.get('invoice.subtotal')?.value | currency }}</p>
      <p>Total (with tax): {{ invoiceForm.get('invoice.total')?.value | currency }}</p>
    </div>

    <!-- Save & Cancel Buttons -->
    <button type="submit" class="save-btn">Save Invoice</button>
    <button class="btn-delete" [routerLink]="['/invoices']">Cancel</button>
  </form>
</div>